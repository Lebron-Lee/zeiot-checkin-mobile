# 中易开工盛典双端互动系统 TODO

## 手机端小程序 (zeiot-checkin-mobile)

### 数据库 & 后端
- [x] 设计并迁移数据库Schema（签到、心愿卡、问答、奖项、抽奖、分组、活动配置）
- [x] 签到API：生成AI头像、记录签到
- [x] 心愿卡API：提交、查询
- [x] AI问答API：题目、答题、积分
- [x] 奖项API：奖项列表、获奖名单、AI颁奖词生成
- [x] 抽奖API：抽奖活动、执行抽奖、AI分组
- [x] WebSocket服务：实时推送签到/心愿卡/颁奖词/抽奖结果到大屏
- [x] 初始化数据：奖项、AI问答题目、活动配置、抽奖活动

### 手机端页面
- [x] 活动预热倒计时页（首页）：主题、时间、地点、倒计时、签到人数
- [x] AI数字签到页：选部门/寄语、生成AI风格头像、成功动画
- [x] 活动日程页：上午/下午/晚间完整流程时间表（时间线样式）
- [x] 奖励展示页：奖项介绍、获奖名单、游戏奖励说明
- [x] AI互动问答页：知识问答、答对提示红包、进度追踪
- [x] 心愿卡页：填写心愿、颜色选择、提交到大屏心愿墙
- [x] 个人签到状态页：AI头像展示、参与统计、快速入口

### 大屏端页面（集成在同一项目）
- [x] 实时签到墙：AI头像5×5网格拼图、新签到发光动画
- [x] 签到统计：签到人数、进度条、实时更新
- [x] 实时签到动态流：最新签到记录滚动显示
- [x] AI颁奖词弹窗：颁奖仪式大屏展示（15秒自动关闭）
- [x] 现金游戏抽奖：AI随机抽奖结果弹窗（12秒自动关闭）
- [x] 心愿墙展示：实时显示员工心愿卡（3列网格）
- [x] 分组结果展示：AI随机分组结果彩色展示
- [x] 大屏标签切换：实时签到/心愿墙/分组结果自动轮播
- [x] 实时时钟：大屏右上角实时时钟

### 管理员控制台
- [x] 管理员控制台页面（/admin）
- [x] AI颁奖词生成：选奖项+输入获奖者→AI生成→同步大屏
- [x] 执行抽奖：选抽奖活动→AI随机抽奖→同步大屏
- [x] AI随机分组：设置组数→随机分组→同步大屏

### 双端实时互动
- [x] WebSocket连接：手机端→大屏端实时推送
- [x] 签到实时同步：手机签到→大屏头像出现
- [x] 心愿卡实时同步：手机提交→大屏心愿墙显示
- [x] 颁奖词实时同步：管理员生成→大屏弹窗展示
- [x] 抽奖结果实时同步：管理员抽奖→大屏弹窗展示
- [x] 分组结果实时同步：管理员分组→大屏切换展示

### 视觉风格
- [x] 全局优雅精致主题（深色金色渐变）
- [x] 玻璃态卡片效果（glass-card）
- [x] 金色发光边框（border-gold-glow）
- [x] 粒子背景动画
- [x] 科技感网格背景（大屏端）
- [x] 手机端移动端适配
- [x] framer-motion动画效果（签到仪式感、页面切换）
- [x] 金色渐变文字（text-gold-gradient）

### 测试
- [x] 签到路由测试（4个测试用例）
- [x] 心愿卡路由测试（3个测试用例）
- [x] AI问答路由测试（4个测试用例）
- [x] 抽奖路由测试（4个测试用例）
- [x] 颁奖词生成测试（2个测试用例）
- [x] 活动配置测试（2个测试用例）
- [x] 认证路由测试（3个测试用例）
- [x] 全部25个测试通过

## 待优化（可选）
- [ ] 大屏端独立部署（当前集成在同一项目，通过路由区分）
- [ ] 签到二维码生成功能

## v2.0 优化（2026-02-25）
- [x] 参考火山引擎配色，重构全局CSS为喜庆红金主题
- [x] 签到按钮时间锁（2026-03-01 08:00 后可用）
- [x] 移动端增加活动报名功能（/register）
- [x] AI问答移除红包，改为纯知识问答（20道AI题含详细解析）
- [x] 管理后台简化重构（概览/签到/颁奖/抽奖/心愿五Tab）
- [x] 编写完整部署手册（DEPLOYMENT.md）

## v3.0 优化（2026-02-25 第三轮）
- [x] 读取…2026年年会活动策划文档，提取行程表和人员数据
- [x] 修复AI问答自动选中正确答案的bug（重写状态管理，使用localAnsweredIds隔离已答题目）
- [x] 隐藏所有红包相关信息提示
- [x] 注册角色增加「特邀嘩宾」选项（正式员工/特邀嘩宾/合作伙伴）
- [x] 按文档更新活动日程（取消晚间场，仅保留上午场+下午场）
- [x] 更新分组预设：按文档人数统计，雷总/刘总/王总固定分入不同组
- [x] AI分组功能改为基于注册用户列表进行分组
- [x] 后台增加一键初始化功能（清空测试数据）
- [x] 设置管理员手机号：用户首次登录后通过Database面板设置 role=admin

## v3.1 优化（2026-02-25）
- [x] 根据活动策划文档精确重写活动日程模块，优化活动名称表述（时间节点精确对应文档，新增详细说明展开、现金奖励标注、奖项/游戏速览卡）

## v4.0 重构（2026-02-25 第四轮）
- [x] 修复AI问答流程：答对直接跳下题、答错原地提示错误+给出正确答案及解释、最终总结答题情况
- [x] 大屏顶部重构：Logo放大、标题横排放大、去掉右侧签到人数和实时时间
- [x] 签到改为刷脸拍照（AI科技感UI），去掉AI生成头像功能
- [x] 签到墙显示本人真实照片（非AI生成头像）
- [x] 未登录用户点击签到引导注册，注册登录用户正常签到
- [x] 用户采用本地注册体系（手机号/姓名注册）
- [x] 后台管理增加调试模式开关（开启时跳过签到时间限制）
- [x] 更新部署手册（v4.0完整版，17个章节）

## v4.1 优化（2026-02-26）
- [x] 更新活动地点为"中易物联唐山分公司易识通"
- [x] 按新日程重写活动日程页面（7:00北京集合→8:30签到→9:30合影→致词→马上有錢游戏→战略发布→聚餐→颁奖→誓师立愿→16:00结束）
- [x] 同步更新数据库event_config中的地点配置

## v4.2 优化（2026-02-26）
- [x] 去掉手机端首页荣誉殿堂入口
- [x] 取消管理后台登录限制，无需用户登录即可访问

## v4.3 修复（2026-02-26）
- [ ] 修复刷脸签到摄像头权限问题（HTTPS检测、权限引导、错误提示）
- [ ] 用户认证完全切换为本地registrations表，脱离Manus OAuth

## v4.4 修复（2026-02-26）
- [x] 修复手机端登录成功后页面重定向失败（停在注册引导页）
- [x] 修复管理后台调试模式开启后报错（event.updateConfig/admin/lottery/award改为publicProcedure）
## v4.5 修复（2026-02-26）
- [x] 整体字体放大（html font-size调为18px）
- [x] 去掉签到时间限制（3月1日08:30才能签到的限制）
- [x] 修复本地部署后注册/登录成功但无登录状态问题（cookies.ts中本地HTTP改用sameSite:lax）
- [x] 修复未登录点击“我的”后点登录按钮报错（改为跳转/register）

## v4.6 修复（2026-02-27）
- [x] 修复手机端摄像头调用失败（改为input[capture=user]直接调起前置摄像头，完全兼容HTTP和所有手机浏览器）
- [x] AI人脸识别改为模拟效果（拍照后播放扫描动画2.5秒，显示识别成功后跳转预览）
- [x] 预设 AI随机分组名单（21人实际名单，默认4组）
- [x] 修复分组大于3组时无效的bug（去掉effectiveGroupCount的领导人数限制）

## v4.7 修复（2026-02-27）
- [x] 确保雷总、王总、刘总严格分到不同组（修复后端分组逻辑，领导固定分入第0/1/2组，其余成员随机轮流分配）

## v4.8 需求/修复（2026-02-27）
- [x] 心愿墙增加头像（wish_cards表添加userAvatar字段，提交时从签到记录获取头像）
- [x] 心愿卡改为随机飘动样式（绝对定位+连续飘动动画）
- [x] 签到实时动态改为自动滚动样式（requestAnimationFrame平滑滚动，到底无缝回顶）
- [x] 大屏页签自动切换（只在checkin↔wish间切换，手动选分组时暂停，选其他时恢复）
- [x] 本地部署摄像头问题（已用input[capture=user]修复，完全兼容HTTP环境）
- [x] 修复本地部署AI问答无法加载题目（服务器启动时自动seedQuizQuestionsIfEmpty）
- [x] 修复大屏签到时间显示（使用toLocaleTimeString本地时间，避免UTC偏差）
- [x] 手机端"我的"隐藏问答红包卡片和按钮

## v4.9 修复（2026-02-27）
- [x] 修复心愿卡提交SQL报错（createWishCard中将null改为undefined）
- [x] 大屏"签到墙"标题已更新
- [x] 大屏签到墙头像降级显示（无头像时显示姓名首字）
- [x] 大屏签到时间使用toLocaleTimeString本地时区
- [x] 同一人多次签到改为upsert（覆盖旧记录）
- [x] 更新AI问答题库（110道前沿AI知识题，已去掉公司相关题）
- [x] 每次问答随机抽取10题（会话开始时固定题目集）
- [x] 修复答题逻辑（重写Quiz.tsx，修复答对/答错状态竞态问题）

## v4.10 需求（2026-02-27）
- [x] 取消手机端 AI问答入口（首页导航卡片已隐藏）
- [x] 大屏端取消「分组」页签，改为AI问答页签
- [x] 大屏端增加AI问答（出题按钮随机出题、手动选答、对错高亮、正确答案和讲解）
- [x] 后台管理心愿墙改为表格样式，增加序号列、提交人列，按提交时间升序排序

## v4.11 需求（2026-02-27）
- [x] 手机端首页去掉「AI签到」导航卡片，只保留「立即AI签到」主按钮

## v4.12 需求（2026-02-27）
- [x] 大屏心愿墙改为弹幕漂浮模式（DanmakuWishWall组件，6条轨道各自滚动）
- [x] 页签切换后保留心愿卡漂浮状态（组件提升到Tab外部，visibility控制显隐）
- [x] 更新AI问答题库为150道前沿AI知识题（全郠去掉公司相关题）

## v4.13 修复（2026-02-28）
- [x] 修复大屏AI问答答对提示错误（新增getQuestionsWithAnswers接口，大屏端返回完整数据含正确答案和解析）
- [x] 修复大屏AI问答解析显示undefined（同上，使用含答案接口）
- [x] 去掉大屏AI问答「题库共20道前沿AI知识题」提示信息（已确认当前版本无此文字）
- [x] 重新设计大屏心愿墙：改为3列错位瀑布流（WaterfallColumn组件，requestAnimationFrame平滑滚动，各列速度不同产生错落感，彻底避免卡片重叠）
